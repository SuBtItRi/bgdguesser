<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Поиск по Белгороду</title>
    <link rel="icon" href="images/logo.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <link rel="stylesheet" href="magnify.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" charset="utf-8"></script>
    <style>
        #warning-message {
            display: none;
        }

        @media only screen and (orientation: portrait) {
            #main {
                display: none;
            }

            #warning-message {
                display: block;
            }
        }

        @media only screen and (orientation: landscape) {
            #warning-message {
                display: none;
            }
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-image: url('images/bg.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            cursor: default;
        }

        .column {
            width: 50%; /* Ширина каждого столбца */
            border: 1px solid #e8e8e8; /* Граница для визуального разделения */
            padding: 10px;
            box-sizing: border-box;
        }

        .container {
            margin-bottom: 7%;
            text-align: center;
        }

        .search-box {
            background-color: rgba(255, 255, 255);
            padding: 20px;
            border-radius: 10px;
            line-height: 0.5;
        }

        .start-game-popup {
            background-color: rgba(255, 255, 255);
            padding: 20px;
            border-radius: 10px;
            line-height: 0.5;
        }

        .click-btn {
            justify-content: center;
            align-items: center;
            margin: 0.5rem;
            line-height: 35px;
            border: 1px solid;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
            text-decoration: none;
            transition: all 0.35s;
            box-sizing: border-box;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1.3px;
            font-weight: 700;
        }

        .btn {
            background-image: linear-gradient(to right, #52b69a 0%, #76c893 51%, #52b69a 100%);
            background-size: 200% auto;
            background-position: left top;
            border-color: transparent;
            color: white;
            position: relative;
        }

        .btn:hover {
            background-position: right bottom;
            color: springgreen;
            border-color: mediumspringgreen;

            &::before {
                width: 100%;
                border-width: 1px 0 1px 0;
            }

            &::after {
                height: 100%;
                border-width: 0 1px 0 1px;
            }
        }

        .btn::before,
        .btn::after {
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 5px;
            border-style: solid;
            transition: all 0.35s;
            content: "";
            z-index: 1;
        }

        .btn::before {
            width: 0;
            height: 100%;
            border-color: mediumspringgreen;
            border-width: 1px 0 1px 0;
        }

        .btn::after {
            width: 100%;
            height: 0;
            border-color: mediumspringgreen;
            border-width: 0 1px 0 1px;
        }

        .close-btn {
            background-image: linear-gradient(to right, #ef4b4b 0%, #f86d6d 51%, #ef4b4b 100%);
            background-size: 200% auto;
            background-position: left top;
            border-color: transparent;
            color: white;
            position: relative;
        }

        .close-btn:hover {
            background-position: right bottom;
            color: #ff0000;
            border-color: #fa0000;

            &::before {
                width: 100%;
                border-width: 1px 0 1px 0;
            }

            &::after {
                height: 100%;
                border-width: 0 1px 0 1px;
            }
        }

        .close-btn::before,
        .close-btn::after {
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 5px;
            border-style: solid;
            transition: all 0.35s;
            content: "";
            z-index: 1;
        }

        .close-btn::before {
            width: 0;
            height: 100%;
            border-color: #fa0000;
            border-width: 1px 0 1px 0;
        }

        .close-btn::after {
            width: 100%;
            height: 0;
            border-color: #fa0000;
            border-width: 0 1px 0 1px;
        }

        #toggle-btn {
            position: absolute;
            border: none;
            background: none;
            padding: 1px 1px;
            font-size: 30px;
            border-radius: 25px;
            cursor: pointer;
            z-index: 9999;
            left: 15px;
            top: 15px;
        }

        .find-wrap {
            align-items: center;
            justify-content: center;
            position: absolute;
            left: 5%;
            bottom: 20%;
        }

        .nc-wrap {
            position: absolute;
            justify-content: center;
            bottom: 20%;
            left: 52.5%;
        }

        .game-btn {
            min-width: 200px;
            min-height: 60px;
            font-family: 'Nunito', sans-serif;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1.3px;
            font-weight: 700;
            color: #313133;
            background: #4FD1C5;
            background: linear-gradient(90deg, rgba(129, 230, 217, 1) 0%, rgba(79, 209, 197, 1) 100%);
            border: none;
            border-radius: 1000px;
            box-shadow: 12px 12px 24px rgba(79, 209, 197, .64);
            transition: all 0.3s ease-in-out 0s;
            cursor: pointer;
            outline: none;
            position: relative;
            padding: 10px;
        }

        .game-btn::before {
            content: '';
            border-radius: 1000px;
            min-width: calc(200px + 12px);
            min-height: calc(60px + 12px);
            border: 6px solid #00FFCB;
            box-shadow: 0 0 60px rgba(0, 255, 203, .64);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: all .3s ease-in-out 0s;
        }

        .game-btn:hover, .game-btn:focus {
            color: #313133;
            transform: translateY(-6px);
        }

        .game-btn:hover::before, .game-btn:focus::before {
            opacity: 1;
        }

        .game-btn::after {
            content: '';
            width: 30px;
            height: 30px;
            border-radius: 100%;
            border: 6px solid #00FFCB;
            position: absolute;
            z-index: -1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: ring 1.5s infinite;
        }

        .game-btn:hover::after, .game-btn:focus::after {
            animation: none;
            display: none;
        }

        @keyframes ring {
            0% {
                width: 30px;
                height: 30px;
                opacity: 1;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }

        .hidden {
            display: none;
        }

        .flex {
            display: flex;
        }

        .result-box {
            position: absolute;
            top: 0;
            right: 0;
            width: 60%;
            bottom: 0;
        }

        .result-img {
            width: 100%;
            pointer-events: none;
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
        }

        .indicator {
            font-family: 'Nunito', sans-serif;
            margin-top: -5px;
            font-size: 24px;
            background-color: #4FD1C5;
            border: none;
            padding: 10px 20px;
            color: #313133;
            text-transform: uppercase;
            letter-spacing: 1.3px;
            font-weight: 700;
        }

        #score {
            font-family: 'Nunito', sans-serif;
            margin-top: 0;
            font-size: 24px;
            border: none;
            padding: 10px 20px;
            color: #313133;
            text-transform: uppercase;
            letter-spacing: 1.3px;
            font-weight: 700;
        }

        #image-counter {
            margin-right: 20%;
        }

        #score-indicator {
            margin-left: 20%;
        }

        #info-popup, #end-game-popup {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255);
            padding: 20px;
            border-radius: 10px;
            z-index: 999;
            text-align: center;
            width: 800px;
        }

        #upd-popup {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255);
            padding: 20px;
            border-radius: 10px;
            z-index: 999;
            width: 60%;
            height: 75%;
        }

        #add-upd-popup {
            height: 85%;
            overflow-y: scroll;
        }

        p {
            line-height: 1.2;
            text-align: left;
        }

        h4 {
            line-height: 0;
            text-align: left;
        }

        a {
            color: #00b2ff; /* Цвет текста ссылки */
            text-decoration: blink; /* Подчеркивание текста ссылки */
        }

        .yt {
            color: red;
        }

        .yt:hover {
            color: #d80000;
        }

        .vk {
            color: dodgerblue;
        }

        a:hover {
            color: #007bc6; /* Цвет текста ссылки при наведении */
        }

        .logo {
            pointer-events: none;
        }

        .logo-p {
            width: 85%;
            height: auto;
        }

        .start-popup {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .start {
            margin-top: 10%;
        }

        .start:hover + .start-popup {
            display: block;
        }

        .slider-container {
            position: relative;
        }

        .tick-labels {
            position: absolute;
            width: 107%;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            top: 15px; /* Положение сверху */
            color: #313133;
            text-transform: uppercase;
            right: -3%;
        }

        .tick-labels.bottom {
            top: calc(100% + 5px); /* Положение снизу */
            width: 107%;
            right: -5%;
        }

        .slider {
            margin-top: 30px;
            -webkit-appearance: none;
            width: 100%;
            height: 25px;
            border-radius: 12px; /* Скругление углов */
            background: linear-gradient(to right, #32a852 0%, #ffec06 50%, #d9534f 100%);
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 26px;
            height: 26px;
            border-radius: 100%;
            background: #000000;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 26px;
            height: 26px;
            border-radius: 100%;
            background: #000000;
            cursor: pointer;
        }

        #timer {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4FD1C5;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            z-index: 9999;
        }
    </style>
</head>
<body>
<div id="main" class="container">
    <button id="toggle-btn">🔇</button>
    <div class="search-box">
        <img class="logo" src="images/logo.png" alt="Логотип">
        <h4>Версия: <span id="version"></span></h4>
        <button id="start-btn" class="click-btn btn">Начать игру</button>
        <button id="info-btn" class="click-btn btn">Информация</button>
        <button id="upd-btn" class="click-btn btn">Список обновлений</button>
    </div>
    <div class="start-game-popup hidden">
        <h1>      Тайм менеджмент       </h1>
        <div class="slider-container">
            <div class="tick-labels top">
                <span>Ꝏсек</span>
                <span>35сек</span>
                <span>30сек</span>
                <span>25сек</span>
                <span>20сек</span>
                <span>15сек</span>
                <span>10сек</span>
                <span>5сек</span>
            </div>
            <input type="range" min="1" max="8" value="0" class="slider" id="myRange">
            <div class="tick-labels bottom">
                <span>10 оч.</span>
                <span>50 оч.</span>
                <span>60 оч.</span>
                <span>70 оч.</span>
                <span>80 оч.</span>
                <span>90 оч.</span>
                <span>100 оч.</span>
                <span>200 оч.</span>
            </div>
        </div>
        <button id="start-game" class="click-btn start btn">Играть</button>
        <button id="back-btn" class="click-btn close-btn btn">Назад</button>
        <div class="start-popup">Сначала выберете время выделенное на точку</div>
    </div>
    <div id="info-popup" class="hidden">
        <h2>Информация об игре</h2>
        <h4>Правила:</h4>
        <p>Вам будет дано фото, вы должны на карте найти где оно сделано, ставьте точку и нажимайте кнопку
            "Проверить". Таких фото будет 5, после подводятся итоги игры.</p>
        <h4>Почему BGDGUESSR?</h4>
        <p>BGDGUESSR = Bgd guessr = Belgorod guess = Угадай Белгород</p>
        <h3>Создатель: SuBtItRi в <a href="https://t.me/SuBtItRi">TG</a>, <a href="https://vk.com/wolfzxc"
                                                                             class="vk">VK</a>   |   Помогал: Ugrock в <a
                href="https://t.me/ugrock78">TG</a>, <a href="https://www.youtube.com/@Ugrock_78" class="yt">YT</a></h3>
        <button id="close-info-btn" class="click-btn close-btn hidden">Закрыть</button>
    </div>
    <div id="upd-popup" class="hidden">
        <h2>Список обновлений</h2>
        <div id="add-upd-popup">
            <div class="flex">
                <div class="column" id="update-list"></div>
                <div class="column" id="what-update"></div>
            </div>
        </div>
        <button id="close-upd-btn" class="click-btn close-btn hidden">Закрыть</button>
    </div>
    <div class="result-box hidden">
        <div id="timer" class="hidden">
            <div id="countdown"></div>
        </div>
        <img id="image" class="zoom result-img" src="" alt="Результат" data-magnify-src="">
        <div class="indicator">
            <span id="image-counter">1/5</span>
            <span id="score-indicator"></span>
        </div>
        <div id="score"></div>
        <div class="find-wrap">
            <button id="find-btn" class="game-btn hidden">Проверить</button>
        </div>
        <div class="nc-wrap">
            <button id="next-btn" class="game-btn hidden">Далее</button>
            <button id="skip-btn" class="game-btn">Пропустить</button>
            <button id="continue-btn" class="click-btn game-btn hidden">Продолжить</button>
        </div>
    </div>
    <div id="map" class="hidden"></div>
</div>
<div id="end-game-popup" class="hidden">
    <h1>Итоги игры</h1>
    <h2>Ваш итоговый счет: <br><span id="final-score">0</span></h2>
    <button id="restart-btn" class="click-btn btn">Начать заново</button>
</div>
<div id="warning-message" class="container">
    <div class="search-box">
        <img class="logo-p" src="images/logo.png" alt="Логотип">
        <h3>На телефоне сайт работает <br><br>только в горизонтальном положении,<br><br> переверните телефон</h3>
    </div>
</div>
<script src="https://api-maps.yandex.ru/2.1/?apikey=ваш_ключ_апи&lang=ru_RU" type="text/javascript"></script>
<script src="jquery.magnify.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var audio = new Audio('music.mp3');
        audio.loop = true; // Чтобы музыка повторялась
        audio.volume = 0.1;
        audio.pause();
        var pointCount = 37;
        var vl = 0;
        var imageCounter = 1;
        var score = 0;
        var found = false
        var links = document.querySelectorAll('a'); // Находим все ссылки на странице
        var updateListDiv = document.getElementById('update-list');
        var whatUpdateDiv = document.getElementById('what-update');
        const slider = document.getElementById("myRange");
        var mode = 10; // По умолчанию
        var time;
        var c_time;

        function start_zoom() {
            $(document).ready(function () {
                $('.zoom').magnify();
            });
        }

        function start_timer() {
            document.getElementById("timer").classList.remove("hidden");
            time = c_time;
            if (mode === 10) {
                document.getElementById("countdown").textContent = 'Ꝏ';
            } else {
                document.getElementById("countdown").textContent = time;
                var timer = setInterval(function () {
                    time--;
                    document.getElementById("countdown").textContent = time;
                    if (time <= 0) {
                        clearInterval(timer);
                        document.getElementById("timer").classList.add("hidden");
                    }
                    if (time === 0) {
                        document.getElementById('find-btn').click();
                    }
                }, 1000);
            }
        }

        // Обработчик изменения значения ползунка
        slider.addEventListener('input', function () {
            const m_values = [10, 50, 60, 70, 80, 90, 100, 200];
            mode = m_values[parseInt(this.value) - 1];
            const t_values = [-1, 35, 30, 25, 20, 15, 10, 5];
            c_time = t_values[parseInt(this.value) - 1];
            time = c_time;
        });
        // Создаем массив для хранения уже использованных чисел
        var usedNumbers = [];
        document.getElementById('toggle-btn').addEventListener('click', function () {
            vl++;
            if (vl === 0) {
                audio.pause();
                document.getElementById('toggle-btn').innerText = '🔇'
            }
            if (vl === 1) {
                audio.play()
                audio.volume = 0.05;
                document.getElementById('toggle-btn').innerText = '🔈 '
            }
            if (vl === 2) {
                audio.play()
                audio.volume = 0.1;
                document.getElementById('toggle-btn').innerText = '🔉'
            }
            if (vl === 3) {
                audio.play()
                audio.volume = 0.3;
                document.getElementById('toggle-btn').innerText = '🔊'
            }
            if (vl > 3) {
                vl = -1;
            }
        });

        document.getElementById('toggle-btn').addEventListener("contextmenu", function (event) {
            event.preventDefault();
            vl--;
            if (vl <= 0) {
                audio.pause();
                document.getElementById('toggle-btn').innerText = '🔇'
                vl = 4;
            }
            if (vl === 1) {
                audio.play()
                audio.volume = 0.05;
                document.getElementById('toggle-btn').innerText = '🔈 '
            }
            if (vl === 2) {
                audio.play()
                audio.volume = 0.1;
                document.getElementById('toggle-btn').innerText = '🔉'
            }
            if (vl === 3) {
                audio.play()
                audio.volume = 0.3;
                document.getElementById('toggle-btn').innerText = '🔊'
            }
            if (vl < 0) {
                vl = 4;
            }
        });

        // Функция для генерации случайного числа
        function getRandomNumber(min, max) {
            // Генерируем случайное число
            var randomNumber = Math.floor(Math.random() * (max - min + 1)) + min;

            // Проверяем, было ли это число уже использовано
            if (usedNumbers.includes(randomNumber)) {
                // Если число уже использовано, генерируем новое рекурсивно
                return getRandomNumber(min, max);
            } else {
                // Если число не использовалось, добавляем его в массив используемых чисел и возвращаем его
                usedNumbers.push(randomNumber);
                return randomNumber;
            }
        }

        // update-list
        var ul = new XMLHttpRequest();
        ul.onreadystatechange = function () {
            if (ul.readyState === XMLHttpRequest.DONE) {
                if (ul.status === 200) {
                    var updateList = ul.responseText.trim();
                    formatUpdateList(updateList);
                } else {
                    console.error('Ошибка загрузки файла:', ul.status);
                }
            }
        };
        ul.open('GET', 'update-list.txt', true);
        ul.send();

        // Форматирование списка обновлений
        function formatUpdateList(updateList) {
            var updates = updateList.split(/\n(?=\.\d+\.\d+)/); // Разделение на строки по версиям
            var html = '';
            updates.forEach(function (update) {
                var parts = update.split(/\n/); // Разделение на версию и описание
                var version = parts.shift(); // Первая строка - версия
                document.getElementById('version').textContent = version;
                var description = parts.join('<br>'); // Остальные строки - описание
                html += '<p>' + version + '</p>'; // Форматирование версии
                html += '<p>' + description + '</p>'; // Форматирование описания
            });
            updateListDiv.innerHTML = '<h4>Уже добавлено:</h4>' + html; // Вставка HTML на страницу
        }

        // what-update
        var wu = new XMLHttpRequest();
        wu.onreadystatechange = function () {
            if (wu.readyState === XMLHttpRequest.DONE) {
                if (wu.status === 200) {
                    var whatUpdate = wu.responseText.trim();
                    formatWhatUpdate(whatUpdate);
                } else {
                    console.error('Ошибка загрузки файла:', wu.status);
                }
            }
        };
        wu.open('GET', 'what-update.txt', true);
        wu.send();

        // Форматирование списка обновлений
        function formatWhatUpdate(whatUpdate) {
            var whatUpdates = whatUpdate.split(/\n(?=\d+\.\d+\.\d+)/); // Разделение на строки по версиям
            var html = '';
            whatUpdates.forEach(function (whatUpdate) {
                var wparts = whatUpdate.split(/\n/); // Разделение на версию и описание
                var wdescription = wparts.join('<br>'); // Остальные строки - описание
                html += '<p>' + wdescription + '</p>'; // Форматирование описания
            });
            whatUpdateDiv.innerHTML = '<h4>Планируется добавить:</h4>' + html; // Вставка HTML на страницу
        }

        links.forEach(function (link) {
            link.setAttribute('target', '_blank'); // Добавляем атрибут target="_blank"
        });
        // Предотвращаем контекстное меню
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        // Предотвращаем выделение текста
        document.addEventListener('selectstart', function (e) {
            e.preventDefault();
        });
        document.getElementById('info-btn').addEventListener('click', function () {
            document.getElementById('info-popup').classList.remove('hidden');
            document.getElementById('close-info-btn').classList.remove('hidden');
            document.querySelector('.search-box').classList.add('hidden');
        });
        document.getElementById('close-info-btn').addEventListener('click', function () {
            document.getElementById('info-popup').classList.add('hidden');
            document.getElementById('close-info-btn').classList.add('hidden');
            document.querySelector('.search-box').classList.remove('hidden');
        });
        document.getElementById('upd-btn').addEventListener('click', function () {
            document.getElementById('upd-popup').classList.remove('hidden');
            document.getElementById('close-upd-btn').classList.remove('hidden');
            document.querySelector('.search-box').classList.add('hidden');
        });
        document.getElementById('close-upd-btn').addEventListener('click', function () {
            document.getElementById('upd-popup').classList.add('hidden');
            document.getElementById('close-upd-btn').classList.add('hidden');
            document.querySelector('.search-box').classList.remove('hidden');
        });
        document.getElementById('start-btn').addEventListener('click', function () {
            document.querySelector('.search-box').classList.add('hidden');
            document.querySelector('.start-game-popup').classList.remove('hidden')
        })
        document.getElementById('back-btn').addEventListener('click', function () {
            document.querySelector('.search-box').classList.remove('hidden');
            document.querySelector('.start-game-popup').classList.add('hidden')
        })
        document.getElementById('start-game').addEventListener('click', function () {
            start_timer()
            document.getElementById('score-indicator').innerText = score + '/' + mode * 5;
            document.body.style.backgroundImage = 'none';
            document.body.style.backgroundColor = 'whitesmoke';
            document.querySelector('.start-game-popup').classList.add('hidden');
            document.querySelector('.result-box').classList.remove('hidden');
            document.querySelector('#map').classList.remove('hidden');
            document.getElementById('toggle-btn').innerText = '🔉'
            vl = 2;
            var randomNum = getRandomNumber(1, pointCount);
            var imgSrc = 'images/' + randomNum + '.png';
            document.querySelector('.result-img').src = imgSrc;
            document.getElementById('image').setAttribute('data-magnify-src', imgSrc);
            start_zoom()
            audio.play();
            ymaps.ready(init);

            function init() {
                var myMap = new ymaps.Map('map', {
                    center: [50.595414, 36.587277],
                    zoom: 13,
                    controls: [],
                    type: 'yandex#hybrid'
                });
                myMap.events.add('click', function (e) {
                    if (!found) {
                        var coords = e.get('coords');

                        if (myMap.geoObjects.getLength() > 0) {
                            myMap.geoObjects.removeAll();
                        }

                        var placemark = new ymaps.Placemark(coords, {}, {
                            preset: 'islands#greenDotIcon'
                        });

                        myMap.geoObjects.add(placemark);

                        if (myMap.geoObjects.getLength() > 1) {
                            var line = new ymaps.Polyline([
                                myMap.geoObjects.get(0).geometry.getCoordinates(),
                                myMap.geoObjects.get(1).geometry.getCoordinates()
                            ], {}, {
                                strokeColor: '#ff0000',
                                strokeWidth: 2
                            });
                            myMap.geoObjects.add(line);
                        }

                        document.getElementById('find-btn').classList.remove('hidden');
                    }
                });
                var objectsBefore = myMap.geoObjects.getLength();
                document.getElementById('find-btn').addEventListener('click', function () {
                    if (!found) {
                        var objectsAfter = myMap.geoObjects.getLength();
                        fetch('coordinates.txt')
                            .then(response => response.text())
                            .then(data => {
                                var coordinates = data.trim().split('\n');
                                var redPointCoords = coordinates[randomNum - 1].split(', ');

                                var redPlacemark = new ymaps.Placemark(redPointCoords, {}, {
                                    preset: 'islands#redDotIcon'
                                });

                                myMap.geoObjects.add(redPlacemark);

                                // Получаем координаты зеленой точки (пользовательской точки)
                                var userCoords = myMap.geoObjects.get(0).geometry.getCoordinates();

                                // Создаем полилинию, соединяющую эти точки
                                var line = new ymaps.Polyline([
                                    userCoords,
                                    redPointCoords
                                ], {}, {
                                    strokeColor: '#000000', // Цвет линии (зеленый)
                                    strokeWidth: 5 // Толщина линии
                                });
                                // Добавляем полилинию на карту
                                myMap.geoObjects.add(line);
                                var distance = Math.round(ymaps.coordSystem.geo.getDistance(userCoords, redPointCoords));
                                var scoreForRound = Math.max(0, Math.round((3000 - distance) / (3000 / mode)));
                                var zoom = 17;
                                if (objectsAfter != objectsBefore) {
                                    score += scoreForRound;
                                    document.getElementById('score').innerText = 'За эту точку вы получили ' + scoreForRound + ' очков (' + distance + 'м до точки)';
                                    if (distance <= 100) {
                                        zoom = 18
                                    } else if (distance <= 500) {
                                        zoom = 17
                                    } else if (distance <= 1000) {
                                        zoom = 16
                                    } else if (distance <= 2500) {
                                        zoom = 15
                                    } else if (distance <= 5000) {
                                        zoom = 14
                                    } else if (distance <= 10000) {
                                        zoom = 13
                                    } else {
                                        zoom = 12
                                    }
                                    myMap.setCenter([[(userCoords[0] + redPointCoords[0]) / 2], [(userCoords[1] + parseFloat(String(redPointCoords[1]).replace(/\r/g, ''), 10)) / 2]], zoom);
                                } else {
                                    document.getElementById('score').innerText = 'Вы не поставили точку (0 очков)';
                                    scoreForRound = 0;
                                    myMap.setCenter(redPointCoords, zoom);
                                }
                                document.getElementById('score-indicator').innerText = score + '/' + mode * 5 + ' +' + scoreForRound;
                                document.getElementById('find-btn').classList.add('hidden');
                                document.getElementById('score').classList.remove('hidden');
                                document.getElementById('next-btn').classList.add('hidden')
                                document.getElementById('skip-btn').classList.add('hidden');
                                setTimeout(() => {
                                    document.getElementById('score').classList.add('hidden')
                                    if (imageCounter < 5) {
                                        document.getElementById('next-btn').classList.remove('hidden');
                                    } else {
                                        document.getElementById('next-btn').classList.add('hidden')
                                        document.getElementById('continue-btn').classList.remove('hidden');
                                    }
                                }, 5000);
                                found = true;
                            })
                            .catch(error => console.error('Ошибка при загрузке файла:', error));
                    }
                });
                document.getElementById('skip-btn').addEventListener('click', function () {
                    if (!found) {
                        fetch('coordinates.txt')
                            .then(response => response.text())
                            .then(data => {
                                var coordinates = data.trim().split('\n');
                                var redPointCoords = coordinates[randomNum - 1].split(',');

                                var redPlacemark = new ymaps.Placemark(redPointCoords, {}, {
                                    preset: 'islands#redDotIcon'
                                });
                                myMap.geoObjects.add(redPlacemark);
                                document.getElementById('score-indicator').innerText = score + '/' + mode * 5 + ' пропуск';
                                document.getElementById('find-btn').classList.add('hidden');
                                document.getElementById('score').classList.remove('hidden');
                                document.getElementById('next-btn').classList.add('hidden')
                                document.getElementById('skip-btn').classList.add('hidden');
                                document.getElementById('score').classList.add('hidden')
                                if (imageCounter < 5) {
                                    document.getElementById('next-btn').classList.remove('hidden');
                                } else {
                                    document.getElementById('next-btn').classList.add('hidden')
                                    document.getElementById('continue-btn').classList.remove('hidden');
                                }
                                found = true;
                            })
                            .catch(error => console.error('Ошибка при загрузке файла:', error));
                    }
                });
                document.getElementById('next-btn').addEventListener('click', function () {
                    document.getElementById('next-btn').classList.add('hidden')
                    start_timer()
                    myMap.setCenter([50.595414, 36.587277], 13);
                    imageCounter++;
                    if (imageCounter <= 5) {
                        document.getElementById('image-counter').innerText = imageCounter + '/5';
                        document.getElementById('score').classList.add('hidden');
                        document.getElementById('find-btn').classList.add('hidden')
                        document.getElementById('skip-btn').classList.remove('hidden')
                        myMap.geoObjects.removeAll();
                        objectsBefore = myMap.geoObjects.getLength();
                        randomNum = getRandomNumber(1, pointCount);
                        imgSrc = "images/" + randomNum + '.png';
                        document.querySelector('.result-img').src = imgSrc;
                        document.getElementById('image').setAttribute('data-magnify-src', imgSrc);
                        start_zoom()
                        found = false;
                    } else {
                        document.getElementById('next-btn').classList.add('hidden')
                        setTimeout(() => {
                            document.getElementById('score').classList.add('hidden')
                            document.getElementById('continue-btn').classList.remove('hidden')
                        }, 5000);
                    }
                });

                document.getElementById('continue-btn').addEventListener('click', function () {
                    document.getElementById('end-game-popup').classList.remove('hidden');
                    document.getElementById('final-score').innerText = score;
                });

                document.getElementById('restart-btn').addEventListener('click', function () {
                    location.reload();
                });
            }
        });
    });
</script>
</body>
</html>